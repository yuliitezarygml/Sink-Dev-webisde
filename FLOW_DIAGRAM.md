# 📊 Схема обработки ошибок и маршрутизации

## 🔄 Полный процесс работы приложения

```
┌─────────────────────────────────────────────────────────────┐
│  ПОЛЬЗОВАТЕЛЬ ОТКРЫВАЕТ http://localhost:3000               │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │   React Router проверяет │
        │   маршрут: /            │
        └──────────────┬───────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │   Загружается AppContent │
        │   компонент             │
        └──────────────┬───────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │   useEffect запускается  │
        │   loadGallery()          │
        └──────────────┬───────────┘
                       │
                       ▼
        ┌──────────────────────────────────────┐
        │  Пытается подключиться к Strapi      │
        │  galleryApi.getAllGalleries()        │
        └──────────────┬───────────────────────┘
                       │
        ┌──────────────┴──────────────┐
        │                             │
        ▼                             ▼
    ✅ УСПЕХ                      ❌ ОШИБКА
        │                             │
        ▼                             ▼
    setGallery()            setError() + setTimeout()
        │                             │
        ▼                             ▼
    Показывает                 Показывает ошибку
    галерею                    (2 секунды)
        │                             │
        ▼                             ▼
    Loading: false          Loading: false
    Error: null            Error: "Ошибка подключения"
        │                             │
        ▼                             ▼
┌──────────────────┐         navigate('/error')
│   ГАЛЕРЕЯ        │                 │
│   (Фотографии)   │                 ▼
│                  │         ┌──────────────────┐
│   📸 📸 📸       │         │  React Router    │
│   📸 📸 📸       │         │  меняет маршрут  │
│   📸 📸 📸       │         │  на /error       │
│                  │         └────────┬─────────┘
│  💬 (меню)       │                  │
│                  │                  ▼
└──────────────────┘         ┌──────────────────────┐
                              │   Загружается        │
                              │   NotFound компонент │
                              │   (с сообщением об   │
                              │   ошибке сервера)    │
                              └──────────────────────┘
                                     │
                                     ▼
                              ┌──────────────────┐
                              │  СТРАНИЦА 404    │
                              │  (Кот + ошибка)  │
                              │                  │
                              │  "Ошибка         │
                              │  подключения к   │
                              │  серверу"        │
                              │                  │
                              │  [Вернуться на   │
                              │   главную]       │
                              └──────────────────┘
```

## 📋 Таблица маршрутов

```
URL                          │ Компонент      │ Состояние
─────────────────────────────┼────────────────┼──────────────────────
http://localhost:3000/       │ AppContent     │ Loading → Gallery
http://localhost:3000/       │ AppContent     │ Loading → Error → 404
http://localhost:3000/error  │ NotFound       │ "Ошибка сервера"
http://localhost:3000/about  │ NotFound       │ "Страница не найдена"
http://localhost:3000/any    │ NotFound       │ "Страница не найдена"
```

## 🔍 Детальная логика обработки

### Шаг 1️⃣: Инициализация
```
App.tsx создает BrowserRouter и Routes
↓
AppContent компонент монтируется
↓
useEffect вызывает loadGallery()
```

### Шаг 2️⃣: Запрос к серверу
```
galleryApi.getAllGalleries()
↓
Отправляет GET запрос на http://localhost:1337/api/galleries
↓
Ждет ответ...
```

### Шаг 3️⃣: Обработка результата
```
┌─────────────────────────────────┐
│ Получен ответ?                  │
├─────────────────────────────────┤
│ ✅ ДА → setGallery() → показываем галерею
│ ❌ НЕТ → setError() → setTimeout(navigate('/error'), 2000)
│ ⚠️ ОШИБКА → catch() → setError() → setTimeout(navigate...)
└─────────────────────────────────┘
```

### Шаг 4️⃣: Отображение
```
Если ошибка → показываем ошибку 2 сек → перенаправляем на /error
↓
Если success → показываем галерею

Если маршрут /error → NotFound с ошибкой сервера
Если маршрут другой → NotFound с ошибкой 404
```

## 🎨 Состояния UI

### Состояние 1: Загрузка
```
┌─────────────────────┐
│   🔄 Загрузка      │
│   галереи...        │
└─────────────────────┘
```

### Состояние 2: Ошибка перед редиректом
```
┌─────────────────────────────────┐
│   ⚠️ Ошибка подключения к      │
│   серверу: Failed to fetch      │
│                                 │
│   Перенаправление через 2 сек... │
└─────────────────────────────────┘
```

### Состояние 3: Успех
```
┌─────────────────────────────────┐
│   Фотогалерея - GHIFRAME Studio │
│                                 │
│   [ФОТО] [ФОТО] [ФОТО]         │
│   [ФОТО] [ФОТО] [ФОТО]         │
│   [ФОТО] [ФОТО] [ФОТО]         │
│                            💬   │
└─────────────────────────────────┘
```

### Состояние 4: 404 Ошибка сервера
```
┌─────────────────────────────────┐
│              404                │
│                                 │
│        [КОТ КАРТИНКА]           │
│         ОКАК                    │
│                                 │
│   Ошибка подключения к серверу │
│   Убедитесь, что Strapi        │
│   сервер запущен на 1337       │
│                                 │
│   [Вернуться на главную]        │
└─────────────────────────────────┘
```

### Состояние 5: 404 Неизвестная страница
```
┌─────────────────────────────────┐
│              404                │
│                                 │
│        [КОТ КАРТИНКА]           │
│         ОКАК                    │
│                                 │
│        Страница не найдена      │
│                                 │
│   [Вернуться на главную]        │
└─────────────────────────────────┘
```

## ⏱️ Временная шкала событий

```
Время     Событие
────────  ─────────────────────────────────────
0ms       Открывает http://localhost:3000/
100ms     React Router проверяет маршрут /
200ms     Монтируется AppContent компонент
300ms     useEffect запускается
500ms     Отправляется запрос в Strapi
1000ms    ❌ Strapi не отвечает (ошибка)
1100ms    Показывается сообщение об ошибке
2100ms    Редирект на http://localhost:3000/error
2200ms    Загружается NotFound компонент
2300ms    Отображается 404 страница с ошибкой
```

---

**✅ Логика работает просто и надежно!**
